    
import streamlit as st
import pandas as pd
import requests
import random
import matplotlib.pyplot as plt
import os
import tempfile

# URL –≤–∞—à–µ–≥–æ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (Apps Script URL)
WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbw0CPfgmyqLYLRrbo9SohnVk0vhRBG3_cMsDjJETP-3BKiP9bRHAjk8TAFY5caEdNSs/exec'

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Å—Å–∏–∏
if 'current_index' not in st.session_state:
    st.session_state.current_index = 0

if 'decisions' not in st.session_state:
    st.session_state.decisions = []

if 'user_name' not in st.session_state:
    st.session_state.user_name = None

# –í–≤–æ–¥ –∏–º–µ–Ω–∏ –∏ —Å–æ–≥–ª–∞—Å–∏–µ
if st.session_state.user_name is None:
    st.title("–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –§–∏–Ω–∞–Ω—Å–æ–≤—É—é –∏–≥—Ä—É!")
    st.write("""
    **–ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã:**
    - –í–∞–º –±—É–¥–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π.
    - –í–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî —Ä–µ—à–∏—Ç—å, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ "–ê–∫—Ç–∏–≤–æ–º" –∏–ª–∏ "–ü–∞—Å—Å–∏–≤–æ–º".
    - –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ, –∫–∞–∫–æ–π –±—É–¥–µ—Ç –≤–∞—à —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –∫–æ–Ω—Ü–µ!
    """)
    
    user_name = st.text_input("–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∏–≥—Ä—É", key="user_name_input")
    
    consent = st.checkbox(
        "–ù–∞–∂–∏–º–∞—è –∫–Ω–æ–ø–∫—É ¬´–û—Ç–ø—Ä–∞–≤–∏—Ç—å¬ª, —è –¥–∞—é —Å–≤–æ–µ —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –º–æ–∏—Ö –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –§–µ–¥–µ—Ä–∞–ª—å–Ω—ã–º –∑–∞–∫–æ–Ω–æ–º –æ—Ç 27.07.2006 –≥–æ–¥–∞ ‚Ññ152-–§–ó ¬´–û –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö¬ª, –Ω–∞ —É—Å–ª–æ–≤–∏—è—Ö –∏ –¥–ª—è —Ü–µ–ª–µ–π, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –≤ –°–æ–≥–ª–∞—Å–∏–∏ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö *",
        value=False,
        key="consent_checkbox"
    )
    
    if st.button("–ù–∞—á–∞—Ç—å"):
        if not user_name:
            st.error("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è!")
        elif not consent:
            st.error("–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–∞—Ç—å —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.")
        else:
            st.session_state.user_name = user_name

else:
    st.title(f"–ü—Ä–∏–≤–µ—Ç, {st.session_state.user_name}! –ù–∞—á–∏–Ω–∞–µ–º –∏–≥—Ä—É üöÄ")
    
    situations = [
    # 7 –∞–∫—Ç–∏–≤–æ–≤
    {'description': '–ö—É–ø–∏—Ç—å –∫–≤–∞—Ä—Ç–∏—Ä—É –∏ —Å–¥–∞–≤–∞—Ç—å –µ—ë –≤ –∞—Ä–µ–Ω–¥—É. –ü–µ—Ä–≤—ã–π –≤–∑–Ω–æ—Å 200 000 —Ä—É–±, –∞ –∫–∞–∂–¥—ã–π –º–µ—Å—è—Ü –æ—Ç –∞—Ä–µ–Ω–¥—ã –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∞—Ç—å 15 000 —Ä—É–±.', 
     'initial_payment': 200000, 'monthly_cashflow': 15000, 'type': '–ê–∫—Ç–∏–≤'},

    {'description': '–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω–æ–º—É –ø—Ä–æ–µ–∫—Ç—É –Ω–∞ —Ä–∞–Ω–Ω–µ–π —Å—Ç–∞–¥–∏–∏. –í–ª–æ–∂–µ–Ω–∏–µ 100 000 —Ä—É–± —Å –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä—É–µ–º–æ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å—é 7-12% –≥–æ–¥–æ–≤—ã—Ö.', 
     'initial_payment': 100000, 'monthly_cashflow': round(100000 * 0.1 / 12), 'type': '–ê–∫—Ç–∏–≤'},

    {'description': '–ö—É–ø–∏—Ç—å –∞–∫—Ü–∏–∏ —Å –¥–∏–≤–∏–¥–µ–Ω–¥–∞–º–∏. –°—Ç–æ–∏–º–æ—Å—Ç—å –ø–∞–∫–µ—Ç–∞ 50 000 —Ä—É–±. –î–∏–≤–∏–¥–µ–Ω–¥–Ω–∞—è –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å ‚Äî 10 000 —Ä—É–± –≤ –≥–æ–¥.', 
     'initial_payment': 50000, 'monthly_cashflow': round(10000 / 12), 'type': '–ê–∫—Ç–∏–≤'},

    {'description': '–ö—É–ø–∏—Ç—å –∫–æ–º–º–µ—Ä—á–µ—Å–∫—É—é –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å –∏ —Å–¥–∞–≤–∞—Ç—å –µ—ë –≤ –∞—Ä–µ–Ω–¥—É. –í–ª–æ–∂–µ–Ω–∏–µ 150 000 —Ä—É–±, –µ–∂–µ–º–µ—Å—è—á–Ω—ã–π –¥–æ—Ö–æ–¥ 18 000 —Ä—É–±.', 
     'initial_payment': 150000, 'monthly_cashflow': 18000, 'type': '–ê–∫—Ç–∏–≤'},

    {'description': '–ò–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å 80 000 —Ä—É–± –≤ —Ñ–æ–Ω–¥ ETF —Å –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å—é 10% –≤ –≥–æ–¥. –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä—É–µ–º—ã–π –¥–æ—Ö–æ–¥ ‚Äî 8 000 —Ä—É–± –µ–∂–µ–≥–æ–¥–Ω–æ.', 
     'initial_payment': 80000, 'monthly_cashflow': round(8000 / 12), 'type': '–ê–∫—Ç–∏–≤'},

    {'description': '–ö—É–ø–∏—Ç—å –≥–∞—Ä–∞–∂ –∑–∞ 100 000 —Ä—É–± –∏ —Å–¥–∞–≤–∞—Ç—å –µ–≥–æ –≤ –∞—Ä–µ–Ω–¥—É. –ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –¥–æ—Ö–æ–¥ —Å–æ—Å—Ç–∞–≤–∏—Ç 5 000 —Ä—É–±.', 
     'initial_payment': 100000, 'monthly_cashflow': 5000, 'type': '–ê–∫—Ç–∏–≤'},

    {'description': '–ö—É–ø–∏—Ç—å –¥–æ–ª—é –≤ –ø—Ä–∏–±—ã–ª—å–Ω–æ–º –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω–µ –∑–∞ 50 000 —Ä—É–±. –î–æ—Ö–æ–¥ –≤ –º–µ—Å—è—Ü —Å–æ—Å—Ç–∞–≤–∏—Ç 4 000 —Ä—É–±.', 
     'initial_payment': 50000, 'monthly_cashflow': 4000, 'type': '–ê–∫—Ç–∏–≤'},

    # # 10 –ø–∞—Å—Å–∏–≤–æ–≤ (–≤—ã–≥–ª—è–¥—è—Ç –∫–∞–∫ –∑–∞–º–∞–Ω—á–∏–≤—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)
    {'description': '–í–∞—à –∏–¥–µ–∞–ª—å–Ω—ã–π –∞–≤—Ç–æ–º–æ–±–∏–ª—å! –ü–µ—Ä–≤—ã–π –≤–∑–Ω–æ—Å –≤—Å–µ–≥–æ 150 000 —Ä—É–± –∏ –¥–∞–ª–µ–µ –∫–∞–∂–¥—ã–π –º–µ—Å—è—Ü 12 000 —Ä—É–± –Ω–∞ –ø–æ–≥–∞—à–µ–Ω–∏–µ –∫—Ä–µ–¥–∏—Ç–∞.', 
     'initial_payment': 150000, 'monthly_cashflow': -12000, 'type': '–ü–∞—Å—Å–∏–≤'},

    {'description': '–í–∞—à–∏ –¥—Ä—É–∑—å—è —É–∂–µ –∫—É–ø–∏–ª–∏ —ç–ª–µ–∫—Ç—Ä–æ—Å–∞–º–æ–∫–∞—Ç? –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å! –ü–µ—Ä–≤—ã–π –≤–∑–Ω–æ—Å 10 000 —Ä—É–± –∏ –ø–æ—Ç–æ–º –≤—Å–µ–≥–æ 2 000 —Ä—É–± –≤ –º–µ—Å—è—Ü.', 
     'initial_payment': 10000, 'monthly_cashflow': -2000, 'type': '–ü–∞—Å—Å–∏–≤'},

    {'description': '–°—Ç–∏–ª—å–Ω—ã–π –Ω–æ—É—Ç–±—É–∫ –¥–ª—è —Ä–∞–±–æ—Ç—ã –∏ —É—á–µ–±—ã. –ü–µ—Ä–≤—ã–π –≤–∑–Ω–æ—Å 20 000 —Ä—É–± –∏ –ø–æ—Ç–æ–º –∫–∞–∂–¥—ã–π –º–µ—Å—è—Ü –ø–æ 3 000 —Ä—É–±.', 
     'initial_payment': 20000, 'monthly_cashflow': -3000, 'type': '–ü–∞—Å—Å–∏–≤'},

    {'description': '–ö—É–ø–∏—Ç—å –Ω–æ–≤—ã–π –¥–∏–≤–∞–Ω –≤ —Ä–∞—Å—Å—Ä–æ—á–∫—É. –ü–µ—Ä–≤—ã–π –≤–∑–Ω–æ—Å 15 000 —Ä—É–± –∏ –∑–∞—Ç–µ–º –ø–æ 1 500 —Ä—É–± –≤ –º–µ—Å—è—Ü.', 
     'initial_payment': 15000, 'monthly_cashflow': -1500, 'type': '–ü–∞—Å—Å–∏–≤'},

    {'description': '–ü–æ—Ä–∞ –æ–±–Ω–æ–≤–∏—Ç—å –∫—É—Ö–Ω—é! –ù–æ–≤—ã–π –∫—É—Ö–æ–Ω–Ω—ã–π –≥–∞—Ä–Ω–∏—Ç—É—Ä –≤ —Ä–∞—Å—Å—Ä–æ—á–∫—É. –ü–µ—Ä–≤—ã–π –≤–∑–Ω–æ—Å 40 000 —Ä—É–± –∏ 2 500 —Ä—É–± –µ–∂–µ–º–µ—Å—è—á–Ω–æ.', 
     'initial_payment': 40000, 'monthly_cashflow': -2500, 'type': '–ü–∞—Å—Å–∏–≤'},

    {'description': '–°—Ç–∞–Ω—å—Ç–µ —á–∞—Å—Ç—å—é –º–æ–¥–Ω–æ–π —Ç—É—Å–æ–≤–∫–∏! –°—É–ø–µ—Ä-—á–∞—Å—ã –∑–∞ 30 000 —Ä—É–±, –ø–µ—Ä–≤—ã–π –≤–∑–Ω–æ—Å 10 000 —Ä—É–± –∏ –¥–∞–ª–µ–µ –ø–æ 2 000 —Ä—É–± –≤ –º–µ—Å—è—Ü.', 
     'initial_payment': 10000, 'monthly_cashflow': -2000, 'type': '–ü–∞—Å—Å–∏–≤'},

    {'description': '–°—Ç–∏–ª—å–Ω—ã–π —Ç—Ä–µ–Ω–∞–∂—ë—Ä –¥–ª—è –¥–æ–º–∞! –ü–µ—Ä–≤—ã–π –≤–∑–Ω–æ—Å 20 000 —Ä—É–± –∏ –¥–∞–ª–µ–µ –ø–æ 1 800 —Ä—É–± –µ–∂–µ–º–µ—Å—è—á–Ω–æ.', 
     'initial_payment': 20000, 'monthly_cashflow': -1800, 'type': '–ü–∞—Å—Å–∏–≤'},

    {'description': '–ö—É–ø–∏—Ç—å –ø—É—Ç—ë–≤–∫—É –Ω–∞ –º–æ—Ä–µ –º–µ—á—Ç—ã! –í–∞—à–∞ –ø–æ–µ–∑–¥–∫–∞ –∑–∞ 70 000 —Ä—É–±, —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –æ–ø–ª–∞—Ç—ã —á–∞—Å—Ç—è–º–∏ –ø–æ 3 000 —Ä—É–± –≤ –º–µ—Å—è—Ü.', 
     'initial_payment': 20000, 'monthly_cashflow': -3000, 'type': '–ü–∞—Å—Å–∏–≤'},

    {'description': '–°—Ç–∞–Ω—å—Ç–µ –≤–ª–∞–¥–µ–ª—å—Ü–µ–º —ç–ª–∏—Ç–Ω–æ–π –∫–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–Ω–æ–π –≤–µ—â–∏. –ü–µ—Ä–≤—ã–π –≤–∑–Ω–æ—Å 50 000 —Ä—É–± –∏ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ –≤—ã–ø–ª–∞—Ç—ã –ø–æ 2 500 —Ä—É–±.', 
     'initial_payment': 50000, 'monthly_cashflow': -2500, 'type': '–ü–∞—Å—Å–∏–≤'},

    {'description': '–ö—É–ø–∏—Ç—å –Ω–æ–≤—ã–π iPhone –ø–æ –ø–æ–¥–ø–∏—Å–∫–µ! –ü–µ—Ä–≤—ã–π –≤–∑–Ω–æ—Å 15 000 —Ä—É–±, –∑–∞—Ç–µ–º 4 000 —Ä—É–± –≤ –º–µ—Å—è—Ü.', 
     'initial_payment': 15000, 'monthly_cashflow': -4000, 'type': '–ü–∞—Å—Å–∏–≤'},


    # 3 –¥–≤—É—Å–º—ã—Å–ª–µ–Ω–Ω—ã–µ —Å–∏—Ç—É–∞—Ü–∏–∏
    {'description': '–ò–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ —Å—Ç–∞—Ä—Ç–∞–ø –∑–∞ 50 000 —Ä—É–± —Å –≤–æ–∑–º–æ–∂–Ω–æ–π –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å—é –æ—Ç 0 –¥–æ 20 000 —Ä—É–± –µ–∂–µ–º–µ—Å—è—á–Ω–æ.', 
     'initial_payment': 50000, 'monthly_cashflow': random.choice([-5000, 5000, 10000]), 'type': '–ü–∞—Å—Å–∏–≤'},

    {'description': '–£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ –∫–æ–æ–ø–µ—Ä–∞—Ç–∏–≤–µ. –í–∑–Ω–æ—Å 70 000 —Ä—É–± –∏ –≤–æ–∑–º–æ–∂–Ω—ã–π –¥–æ—Ö–æ–¥ –æ—Ç 5 000 —Ä—É–±.', 
     'initial_payment': 70000, 'monthly_cashflow': 5000, 'type': '–ê–∫—Ç–∏–≤'},

    {'description': '–°—Ç–∞–Ω—å—Ç–µ –≤–ª–∞–¥–µ–ª—å—Ü–µ–º —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω–æ–π –∫—Ä–∏–ø—Ç–æ–º–æ–Ω–µ—Ç—ã –∑–∞ 90 000 —Ä—É–±. –ë—É–¥–µ—Ç –ª–∏ –¥–æ—Ö–æ–¥? –ù–∏–∫—Ç–æ –Ω–µ –∑–Ω–∞–µ—Ç.', 
     'initial_payment': 90000, 'monthly_cashflow': 0, 'type': '–ü–∞—Å—Å–∏–≤'}    
    ]
    
    current_index = st.session_state.current_index

    if current_index < len(situations):
        situation = situations[current_index]
        
        st.markdown(f"### üîÑ –í–æ–ø—Ä–æ—Å {current_index + 1} –∏–∑ {len(situations)}")
        st.write(situation['description'])
        
        col1, col2 = st.columns(2)
        with col1:
            if st.button('–ò–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å (–ö—É–ø–∏—Ç—å)'):
                st.session_state.decisions.append({
                    '–ù–∞–∑–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–∞': situation['description'] if situation['type'] == '–ê–∫—Ç–∏–≤' else '',
                    '–°—É–º–º–∞ –∞–∫—Ç–∏–≤–∞': situation['initial_payment'] if situation['type'] == '–ê–∫—Ç–∏–≤' else 0,
                    '–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –¥–µ–Ω–µ–∂–Ω—ã–π –ø–æ—Ç–æ–∫': situation['monthly_cashflow'],
                    '–ù–∞–∑–≤–∞–Ω–∏–µ –ø–∞—Å—Å–∏–≤–∞': situation['description'] if situation['type'] == '–ü–∞—Å—Å–∏–≤' else '',
                    '–°—É–º–º–∞ –ø–∞—Å—Å–∏–≤–∞': situation['initial_payment'] if situation['type'] == '–ü–∞—Å—Å–∏–≤' else 0
                })
                st.session_state.current_index += 1
                st.rerun()
        
        with col2:
            if st.button('–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å (–û—Ç–∫–∞–∑–∞—Ç—å—Å—è)'):
                st.session_state.current_index += 1
                st.rerun()
    
    else:
        st.markdown("## üèÜ –§–∏–Ω–∞–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω")
        
        if len(st.session_state.decisions) == 0:
            st.write("–í—ã –æ—Ç–∫–∞–∑–∞–ª–∏—Å—å –æ—Ç –≤—Å–µ—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π. –ò–Ω–æ–≥–¥–∞ —ç—Ç–æ —Ç–æ–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ, –Ω–æ –≤ –∂–∏–∑–Ω–∏ –≤–∞–∂–Ω–æ –Ω–µ —É–ø—É—Å–∫–∞—Ç—å —à–∞–Ω—Å—ã!")
        
        else:
            df = pd.DataFrame(st.session_state.decisions)
            
            if not df.empty:
                df = df[['–ù–∞–∑–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–∞', '–°—É–º–º–∞ –∞–∫—Ç–∏–≤–∞', '–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –¥–µ–Ω–µ–∂–Ω—ã–π –ø–æ—Ç–æ–∫', '–ù–∞–∑–≤–∞–Ω–∏–µ –ø–∞—Å—Å–∏–≤–∞', '–°—É–º–º–∞ –ø–∞—Å—Å–∏–≤–∞']]
                
                df.fillna(0, inplace=True)
                df[['–°—É–º–º–∞ –∞–∫—Ç–∏–≤–∞', '–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –¥–µ–Ω–µ–∂–Ω—ã–π –ø–æ—Ç–æ–∫', '–°—É–º–º–∞ –ø–∞—Å—Å–∏–≤–∞']] = df[['–°—É–º–º–∞ –∞–∫—Ç–∏–≤–∞', '–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –¥–µ–Ω–µ–∂–Ω—ã–π –ø–æ—Ç–æ–∫', '–°—É–º–º–∞ –ø–∞—Å—Å–∏–≤–∞']].astype(int)
                
                st.markdown("### üìä –í–∞—à–∏ –∞–∫—Ç–∏–≤—ã –∏ –ø–∞—Å—Å–∏–≤—ã")
                st.dataframe(df.style.format(
                    {'–°—É–º–º–∞ –∞–∫—Ç–∏–≤–∞': "{:,.0f}", '–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –¥–µ–Ω–µ–∂–Ω—ã–π –ø–æ—Ç–æ–∫': "{:,.0f}", '–°—É–º–º–∞ –ø–∞—Å—Å–∏–≤–∞': "{:,.0f}"}
                ))
                
                total_assets = int(df['–°—É–º–º–∞ –∞–∫—Ç–∏–≤–∞'].sum())
                total_liabilities = int(df['–°—É–º–º–∞ –ø–∞—Å—Å–∏–≤–∞'].sum())
                total_cashflow = int(df['–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –¥–µ–Ω–µ–∂–Ω—ã–π –ø–æ—Ç–æ–∫'].sum())
                
                st.markdown(f"**–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –∞–∫—Ç–∏–≤–æ–≤:** {total_assets:,.0f} —Ä—É–±")
                st.markdown(f"**–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–∞—Å—Å–∏–≤–æ–≤:** {total_liabilities:,.0f} —Ä—É–±")
                st.markdown(f"**–ï–∂–µ–º–µ—Å—è—á–Ω—ã–π –¥–µ–Ω–µ–∂–Ω—ã–π –ø–æ—Ç–æ:** {total_cashflow:,.0f} —Ä—É–±/–º–µ—Å")
                
                fig, ax = plt.subplots(figsize=(12, 4))
                ax.axis('off')
                table = ax.table(cellText=df.values, colLabels=df.columns, cellLoc='center', loc='center')
                table.auto_set_font_size(False)
                table.set_fontsize(10)
                table.auto_set_column_width(col=list(range(len(df.columns))))
                
                temp_dir = tempfile.gettempdir()  
                image_path = os.path.join(temp_dir, 'table.png')
                plt.savefig(image_path, bbox_inches='tight', dpi=300)
                plt.close(fig)

                with open(image_path, "rb") as file:
                    st.download_button(label="üì• –°–∫–∞—á–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É –≤ –≤–∏–¥–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è", 
                                    data=file, 
                                    file_name="—Ñ–∏–Ω–∞–Ω—Å–æ–≤–∞—è_—Ç–∞–±–ª–∏—Ü–∞.png", 
                                    mime="image/png")
                    
            # –î–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
            payload = {
                'user_name': st.session_state.user_name,
                'question_responses': df.to_dict(orient='records'),
                'total_assets': total_assets,
                'total_liabilities': total_liabilities,
                'total_cashflow': total_cashflow
            }
            
            if total_cashflow > 0:
                st.success(f"–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º, {st.session_state.user_name}! –í—ã –æ—Ç–ª–∏—á–Ω–æ —Å–ø—Ä–∞–≤–∏–ª–∏—Å—å, –∏ –≤–∞—à –∏—Ç–æ–≥–æ–≤—ã–π –¥–µ–Ω–µ–∂–Ω—ã–π –ø–æ—Ç–æ–∫ —Å–æ—Å—Ç–∞–≤–∏–ª **{total_cashflow:,.0f} —Ä—É–±/–º–µ—Å**.")
                st.balloons()
                # st.image('gold_medal.png', caption='–ó–æ–ª–æ—Ç–∞—è –º–µ–¥–∞–ª—å!', width=150)
            else:
                st.error(f"{st.session_state.user_name}, –≤–∞—à –∏—Ç–æ–≥–æ–≤—ã–π –¥–µ–Ω–µ–∂–Ω—ã–π –ø–æ—Ç–æ–∫ —Å–æ—Å—Ç–∞–≤–∏–ª **{total_cashflow:,.0f} —Ä—É–±/–º–µ—Å**. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–≤–æ–∏ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è.")
    
    
            # –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
            try:
                response = requests.post(WEB_APP_URL, json=payload)
                
                if response.status_code == 200:
                    st.success("‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ Google —Ç–∞–±–ª–∏—Ü—É!")
                else:
                    st.error(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –¥–∞–Ω–Ω—ã—Ö. –ö–æ–¥ –æ—à–∏–±–∫–∏: {response.status_code}")
            
            except Exception as e:
                st.error(f"‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –¥–∞–Ω–Ω—ã—Ö: {e}")
        